# BlueFors Data Logger and Monitor

This project provides tools for logging and monitoring BlueFors dilution refrigerator data, processing logs into a PostgreSQL database for further analysis.

## Features

- **Log to Database**: Process historical logs and insert them into the database.
- **Real-Time Monitoring**: Continuously monitor logs of the current day and update the database every minute.

---

## Setup Instructions

### 1. Install Dependencies

Ensure you have Python and PostgreSQL installed. Set up a Python environment:

```bash
conda create -n fridge_env python=3.9 -y
conda activate fridge_env
pip install -r requirements.txt
```

### 2. Set Up the PostgreSQL Database

1. Start PostgreSQL:
   ```bash
   service postgresql start
   ```
2. Log in as the `postgres` user:

   ```bash
   psql -U postgres
   ```

3. Create a new database:

   ```sql
   CREATE DATABASE bashful_data;
   ```

4. Create a user and grant privileges:

   ```sql
   CREATE USER bluefors_user WITH PASSWORD 'your_password';
   GRANT ALL PRIVILEGES ON DATABASE bashful_data TO bluefors_user;
   ```

5. Exit the `psql` shell:
   ```bash
   \q
   ```

---

### 3. Configure the `.env` File

Create a `.env` file in the project root with the following structure:

```ini
DB_NAME=bashful_data
DB_USER=bluefors_user
DB_USER_PW=your_password
DB_IP=127.0.0.1
DB_PORT=5432
```

Replace `your_password` with the actual database password.

---

### 4. Folder Structure

Ensure log files are organized by date in a `logs` directory:

```
logs/
├── 22-07-20/
│   ├── CH1 T 22-07-20.log
│   ├── CH1 P 22-07-20.log
│   ├── Flowmeter 22-07-20.log
│   ├── Channels 22-07-20.log
│   └── ...
├── 22-07-21/
│   ├── ...
```

---

## Programs

### 1. **Log to Database**

**File**: `log_to_db.py`  
**Purpose**: Processes historical log files and inserts them into the database.

**Usage**:

```bash
python log_to_db.py
```

**Description**:

- Scans all log directories (by date) in the `logs/` folder.
- Processes `temperature`, `pressure`, `resistance`, `status`, and `flowmeter` logs.
- Ensures tables exist in the database before inserting data.

---

### 2. **Real-Time Monitor**

**File**: `log_monitor.py`  
**Purpose**: Continuously monitors logs for the current day and updates the database every minute.

**Usage**:

```bash
python log_monitor.py
```

**Description**:

- Monitors logs of the current day in the `logs/` folder.
- Automatically detects when the day changes and starts monitoring the new day's logs.
- Ensures no duplicate data is added to the database.
- Designed to run indefinitely, suitable for deployment on the logging machine.

**To Run as Background Process**:

```bash
nohup python log_monitor.py &
```

---

## Notes

- The database uses `ON CONFLICT DO NOTHING` to avoid duplicate entries.
- Log files must follow the naming convention:
  - `CHX T YY-MM-DD.log` for temperature
  - `CHX P YY-MM-DD.log` for pressure
  - `CHX R YY-MM-DD.log` for resistance
  - `Channels YY-MM-DD.log` for status
  - `Flowmeter YY-MM-DD.log` for flow rates
- Ensure log files are accessible and in the correct format for successful processing.

For questions or troubleshooting, please refer to the code comments or reach out to the project maintainer.

---

**Generated by GPT-4o**
